"""
@version: 0.1

Map reads with Tophat (needs Bowtie in place for creation of index)

Required programs:
* Stringtie

"""

__author__ = "Jan van Haarst"
__email__ = "jan.vanhaarst@wur.nl"



STRINGTIE_VERSION = subprocess.check_output("stringtie --version", shell=True)

rule stringtie:
    # https://ccb.jhu.edu/software/stringtie/index.shtml
    input:
        BAM = "TOPHAT/{sample}/{library}/{replicate}/{name}/accepted_hits.bam",
        GTF = CONFIG["refGTF"]
    output: "STRINGTIE/{sample}/{library}/{replicate}/{name}/transcripts.gtf"
    message: """Run Stringtie on mapped data"""
    threads: 8
    version: STRINGTIE_VERSION
    params:
        options = CONFIG["stringtie"]["options"]
    shell:
        """
        stringtie {params.options} -p {threads} -G {input.GTF} -o {output} {input.BAM}
        """
