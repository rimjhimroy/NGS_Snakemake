###################
##  Transposome  ##
###################

import os, subprocess
import configparser
from Transposome import *

       
rule install_transposome:
    input:
        rules.install_perl_libs.output,
        PERL=rules.install_perl.output
    output: ""  + CONFIG["executables"]["transposome"] + "/bin/transposome"
    shell:
        "TEMPDIR=`mktemp -p " + CONFIG["base"]["download_dir"] + " -d` && "
        "cd $TEMPDIR && "
        "wget https://github.com/sestaton/Transposome/archive/v0.09.7.tar.gz && "
        "tar xzf v0.09.7.tar.gz && cd Transposome-* && "
        "curl -L cpanmin.us | {input.PERL} - --installdeps . && {input.PERL} Makefile.PL && make && make install && "
        "mv -f * " + CONFIG["executables"]["transposome"] + " && cd .. && rm -rf Transposome* "

rule transposome:
    input: 
        rules.install_transposome.output
    params : configured = read_yml(CONFIG, "config.yml")
    output: "" + CONFIG["base"]["output"] + "/config.yml"
    shell:
        "source {rules.bashrc.output} && "
        "mkdir -p "+ CONFIG["base"]["output"] + " && "
        'echo "{params.configured}" > ' + CONFIG["base"]["output"] + "/config.yml && "
        "{rules.install_transposome.output} --config "+ CONFIG["base"]["output"] + "/config.yml"
    