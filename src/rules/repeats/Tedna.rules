#############
##  Tedna  ##
#############

import os, subprocess
import configparser

# Download and install Tedna
rule tedna_installation:
	output: CONFIG["executables"]["tedna"]
	shell:
		"mkdir -p " + CONFIG["base"]["executables"] + " && "
		"cd " + CONFIG["base"]["executables"] + " && "
		"wget" + CONFIG["executable_sources"]["wget_options"] + CONFIG["executable_sources"]["Tedna_URL"] + " && "
		"chmod +x " + CONFIG["executables"]["tedna"] + " && "
		"touch {output}"

# Run Tedna
rule tedna:
	input:
		TEDNA = rules.tedna_installation.output,
		forward = CONFIG["base"]["working_dir"] + "/reads/{sample}/{library}/{readset}/{name}_1.fastq",
		reverse = CONFIG["base"]["working_dir"] + "/reads/{sample}/{library}/{readset}/{name}_2.fastq"
	output: "tedna_repeats/{sample}/{library}/{readset}/{name}.fasta"
	shell:
		"{input.TEDNA} -1 {input.forward} -2 {input.reverse} " + CONFIG["tedna_opts"]["cl_options"] + "-o {output}"
